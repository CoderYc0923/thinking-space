## 项目回顾汇总

### 业务线集成平台

#### 即时通讯IM客服聊天

1.webSocket技术
    概念：基于TCP的一种应用层网络协议，提供了一个全双工的通道，允许服务器和客户端之间的实时双向通信，浏览器和服务器只需要完成一次握手，两者之间就直接可以创建持久性的连接， 并进行双向数据传输。协议标识符是ws（如果加密，则为wss），服务器网址就是 URL。
    WebSocket 数据帧结构和控制帧结构：
        1.WebSocket 数据帧主要包括两个部分：帧头和有效载荷。   
        2.WebSocket 协议还包括一些控制帧，主要包括 Ping、Pong 和 Close 帧。
            Ping 帧用于测试客户端和服务端之间的连接状态，客户端向服务端发送 Ping 帧，服务端收到后需要向客户端发送 Pong 帧进行响应。
            Close 帧用于关闭客户端和服务端之间的连接
    
    为什么需要WebSocket？
        HTTP协议通信只能由客户端发起，服务器主动向客户端推送信息。一些需要实时的场景需求通过轮询的话效率低且浪费资源

    WebSocket心跳机制
        前端实现WebSocket心跳机制：1.使用setInterval定时发送心跳包 2.在前端监听到WebSocket的onclose()事件时，重新创建WebSocket连接。3.使用比如Sockjs、Stompjs这样的插件库
        （第一种方式会对服务器造成很大的压力，因为即使WebSocket连接正常，也要定时发送心跳包，从而消耗服务器资源。第二种方式虽然减轻了服务器的负担，但是在重连时可能会丢失一些数据。）

        WebSocket心跳包是WebSocket协议的保活机制，用于维持长连接。有效的心跳包可以防止长时间不通讯时，WebSocket自动断开连接。
        心跳包是指在一定时间间隔内，WebSocket发送的空数据包。常见的WebSocket心跳包机制如下：
            1.客户端定时向服务器发送心跳数据包，以保持长连接。
            2.服务器定时向客户端发送心跳数据包，以检测客户端连接是否正常。
            3.双向发送心跳数据包。
        
        WebSocket心跳机制原理
            1.客户端建立WebSocket连接。
            2.客户端向服务器发送心跳数据包，服务器接收并返回一个表示接收到心跳数据包的响应。
            3.当服务器没有及时接收到客户端发送的心跳数据包时，服务器会发送一个关闭连接的请求。
            4.服务器定时向客户端发送心跳数据包，客户端接收并返回一个表示接收到心跳数据包的响应。
            5.当客户端没有及时接收到服务器发送的心跳数据包时，客户端会重新连接WebSocket

2.重连退避机制
    通常服务端会提供lbs（Location Based Services，LBS）接口，来提供最优节点，我们端上要做便是缓存这些地址并设定端上的重连退避机制。按级别次数进行（重连、换连接地址重连、重新获取连接地址、上层处理）处理

3.聊天记录监控预警
    监听websocket的message事件获取聊天信息，然后对应的处理聊天信息

4.消息合并和缓冲解决UI卡顿
    因为在聊天室的场景下，每个消息的添加都会触发回流，当存在在极短时间内大量消息时，就可能会引起页面卡顿。所以需要尽量减少回流的触发，就可以考虑消息合并和缓冲。
    服务端和客户端约定好解析协议，服务端将消息合并发送给客户端，客户端接收合并消息并批量展示在页面上。

5.indexDB实现增量同步会话和历史记录
    只同步自上次同步以来发生的变化，而不是同步所有数据
    在用户打开聊天窗口时，若会话和历史记录一次性都由服务器返回，会增加页面等待时间以及服务器压力。所以考虑使用IndexedDB实现增量同步会话和历史记录。
    以减少网络传输、提高响应速度。

    为什么使用indexDB?
        1.indexDB支持异步，能够很好的减少等待时间，而类似localStorage是同步的
        2.indexDB存储空间大一般250MB
        3.indexDB支持事务，在一系列操作中，只要有一步失败了，就会回滚到事务发生前的状态，不会只改写一部分数据
        4.indexDB支持存储的数据格式多，不仅可以存储字符串，也可以存储二进制数据
    
6.虚拟列表
    使用交叉观察器实现，intersectionObserver(func,options),其中options的rootMain特别符合虚拟列表中的缓存区设计


#### 在线培训平台

1.文件分片上传、秒传、断点续传（https://blog.csdn.net/CRMEB/article/details/135203003）
    分片上传：使用File Api对大文件分割成固定大小的块，然后将每个块都上传到服务器，然后发送一个合并请求，同时根据文件内容计算生成唯一的hash也传递到服务器以区分文件块（使用spark-md5工具）
    秒传：在上传前，计算文件的hash并将其上传到服务器来得知是否存在该文件，若存在，就直接提示上传成功
    断点续传：在分片上传的时候给对应的分片加上传状态，当上传中断后重新上传，则通过每个分片的上传状态来判断是否上传


#### 低代码平台物料组件
    低代码平台如何加载组件？
        通过远程异步组件的形式加载组件物料


